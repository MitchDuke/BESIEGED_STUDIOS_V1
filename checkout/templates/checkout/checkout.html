{% extends "base.html" %}

{% block title %}Checkout{% endblock %}

{% block content %}
<div class="container">
    <h1>Checkout</h1>
    <p>Please review your order and proceed to payment.</p>

    {% if basket_items %}
        <table class="table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in basket_items %}
                <tr>
                    <td>{{ item.project.title }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.project.price|floatformat:2 }}</td>
                    <td>{{ item.total_price|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button id="checkout-button" class="btn btn-success">Proceed to Payment</button>
    {% else %}
        <p>Your basket is empty.</p>
    {% endif %}
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    document.getElementById('checkout-button').addEventListener('click', function () {
        fetch("{% url 'checkout:create_checkout_session' %}", {
            method: "GET",
    })
    .then(response => response.json())
    .then(data => {
        const stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');
        stripe.redirectToCheckout({ sessionId: data.session_id });
    })
    .catch(error => {
        console.error('Error:', error);
    });
});
</script>
{% endblock %}